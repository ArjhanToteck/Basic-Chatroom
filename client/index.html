
<head>
	<style>
		button {
			height: 25;
			width: 105;
		}

		input {
			height: 25;
		}
	</style>
	<title>Chatroom | ArjhanToteck</title>
	<link rel="icon" href="/favicon.png">
	<link href="/style.css" rel="stylesheet" type="text/css" media="all">
</head>

<body>
	<h1 class="glitch" id="heading" data-text="Chatroom">Chatroom</h1>
	<div id="chat"></div>
	<div id="chatInput">
		<input size="35" autocomplete="off" placeholder="Message" autofocus id="messageBox">
		<button onclick="sendMessage()">Send</button>
	</div>
</body>

<script>
	const server = "fa3b157f-1755-46f8-ae53-3f7655748664-00-7j0o8vn1p6mh.kirk.repl.co";
	let password;
	let gameCode;
	let connection;

	setUpConnection();

	// adds enter key event listener
	document.addEventListener('keydown', function(event) {
		if (event.key == "Enter") {
			sendMessage();
		}
	});

	function setUpConnection() {
		// establishes connection with websocket server
		connection = new WebSocket(`wss://${server}`);

		// waits until connection opened
		connection.addEventListener("open", function(event) {
			console.log("opened");
		});

		// recieve websocket messages
		connection.addEventListener("message", function(event) {
			const messages = JSON.parse(event.data);
			handleWebSocketMessage(messages);
		});
	}

	function sendMessage() {
		connection.send(JSON.stringify({
			message: messageBox.value
		}));
		messageBox.value = "";
	}

	function handleWebSocketMessage(messages) {
		// loops through every sent message
		for (let i = 0; i < messages.length; i++) {
			// parses date
			let date = new Date(messages[i].date);

			// shows each message
			messageElement = document.createElement("div");
			messageElement.innerHTML += `<span style="background-color: white; color: #262626">${messages[i].sender} (${date.toLocaleDateString()}, ${date.toLocaleTimeString()})</span><br>`;
			messageElement.innerHTML += `<span style="color: white;">${messages[i].message}</span><br><br>`;

			// shows message
			chat.appendChild(messageElement);
		}
	}
</script>
